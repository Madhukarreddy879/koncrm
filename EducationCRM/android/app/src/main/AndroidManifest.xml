<manifest xmlns:android="http://schemas.android.com/apk/res/android">

    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.CALL_PHONE" />
    <uses-permission android:name="android.permission.READ_PHONE_STATE" />
    <uses-permission android:name="android.permission.RECORD_AUDIO" />
    <uses-permission android:name="android.permission.CAPTURE_AUDIO_OUTPUT" />
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" android:maxSdkVersion="32" />
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" android:maxSdkVersion="32" />
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_MICROPHONE" />
    <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />
    <uses-permission android:name="android.permission.READ_CALL_LOG" />
    <uses-permission android:name="android.permission.MANAGE_OWN_CALLS" />
    <uses-permission android:name="android.permission.ANSWER_PHONE_CALLS" />

    <application
      android:name=".MainApplication"
      android:label="@string/app_name"
      android:icon="@mipmap/ic_launcher"
      android:roundIcon="@mipmap/ic_launcher_round"
      android:allowBackup="false"
      android:theme="@style/AppTheme"
      android:usesCleartextTraffic="true"
      android:networkSecurityConfig="@xml/network_security_config"
      android:supportsRtl="true">
      
      <activity
        android:name=".MainActivity"
        android:label="@string/app_name"
        android:configChanges="keyboard|keyboardHidden|orientation|screenLayout|screenSize|smallestScreenSize|uiMode"
        android:launchMode="singleTask"
        android:windowSoftInputMode="adjustResize"
        android:exported="true">
        <intent-filter>
            <action android:name="android.intent.action.MAIN" />
            <category android:name="android.intent.category.LAUNCHER" />
        </intent-filter>
        <!-- Dialer intent filters for default dialer capability -->
        <intent-filter>
            <action android:name="android.intent.action.DIAL" />
            <category android:name="android.intent.category.DEFAULT" />
        </intent-filter>
        <intent-filter>
            <action android:name="android.intent.action.DIAL" />
            <category android:name="android.intent.category.DEFAULT" />
            <data android:scheme="tel" />
        </intent-filter>
      </activity>
      
      <!-- In-Call Activity -->
      <activity
          android:name=".dialer.InCallActivity"
          android:theme="@style/Theme.AppCompat"
          android:showOnLockScreen="true"
          android:turnScreenOn="true"
          android:exported="false" />
      
      <!-- Recording Service -->
      <service 
          android:name=".RecordingService" 
          android:foregroundServiceType="microphone" 
          android:exported="false" />
      
      <!-- Accessibility Service for Call Recording -->
      <service
          android:name=".CallRecordingAccessibilityService"
          android:permission="android.permission.BIND_ACCESSIBILITY_SERVICE"
          android:exported="false">
          <intent-filter>
              <action android:name="android.accessibilityservice.AccessibilityService" />
          </intent-filter>
          <meta-data
              android:name="android.accessibilityservice"
              android:resource="@xml/accessibility_service_config" />
      </service>
      
      <!-- ConnectionService for Telecom API -->
      <service
          android:name=".dialer.CrmConnectionService"
          android:permission="android.permission.BIND_TELECOM_CONNECTION_SERVICE"
          android:exported="true">
          <intent-filter>
              <action android:name="android.telecom.ConnectionService" />
          </intent-filter>
      </service>
      
      <!-- InCallService for default dialer UI -->
      <service
          android:name=".dialer.CrmInCallService"
          android:permission="android.permission.BIND_INCALL_SERVICE"
          android:exported="true">
          <meta-data
              android:name="android.telecom.IN_CALL_SERVICE_UI"
              android:value="true" />
          <meta-data
              android:name="android.telecom.IN_CALL_SERVICE_RINGING"
              android:value="true" />
          <intent-filter>
              <action android:name="android.telecom.InCallService" />
          </intent-filter>
      </service>
      
      <!-- Dialer Recording Foreground Service -->
      <service
          android:name=".dialer.DialerRecordingService"
          android:foregroundServiceType="microphone"
          android:exported="false" />
      
      <!-- Call Notification Receiver -->
      <receiver
          android:name=".dialer.CallNotificationReceiver"
          android:exported="false">
          <intent-filter>
              <action android:name="com.educationcrm.ACTION_MUTE" />
              <action android:name="com.educationcrm.ACTION_END_CALL" />
          </intent-filter>
      </receiver>

    </application>
</manifest>
